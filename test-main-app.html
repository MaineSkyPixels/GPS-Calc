<!DOCTYPE html>
<html>
<head>
    <title>Main App Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>GPS Coordinate Calculator - Main App Test</h1>
    <div id="output"></div>
    
    <script src="coordinate-parser.js"></script>
    <script src="coordinate-converter.js"></script>
    <script src="distance-calculator.js"></script>
    <script src="script.js"></script>
    <script>
        // Test the main application components
        let output = '';
        
        // Test 1: Coordinate Parser
        output += '<div class="test-section">';
        output += '<h2>Test 1: Coordinate Parser</h2>';
        
        const parser = new CoordinateParser();
        const testInputs = [
            "44.4734240583\t-70.8886269917 500.143",
            "44.473424162  -70.888626958   500.1308",
            "44¬∞ 28' 24.32661\" -70¬∞ 53' 19.05717\"",
            "N44.4734245277 W70.88862750833"
        ];
        
        testInputs.forEach((input, index) => {
            const result = parser.parseCoordinate(input);
            const status = result ? 'success' : 'error';
            const statusText = result ? 'PASS' : 'FAIL';
            output += `<p class="${status}">Test ${index + 1}: "${input}" ‚Üí ${statusText}</p>`;
            if (result) {
                output += `<p class="info">  Result: lat=${result.lat}, lon=${result.lon}</p>`;
            }
        });
        output += '</div>';
        
        // Test 2: Distance Calculator
        output += '<div class="test-section">';
        output += '<h2>Test 2: Distance Calculator</h2>';
        
        const calculator = new DistanceCalculator();
        const testCoords = [
            { lat: 44.4734240583, lon: -70.8886269917, elevation: 500.143 },
            { lat: 44.473424162, lon: -70.888626958, elevation: 500.1308 }
        ];
        
        const dist2D = calculator.calculate2DDistance(testCoords[0].lat, testCoords[0].lon, testCoords[1].lat, testCoords[1].lon);
        const dist3D = calculator.calculate3DDistance(testCoords[0].lat, testCoords[0].lon, testCoords[0].elevation, testCoords[1].lat, testCoords[1].lon, testCoords[1].elevation);
        
        output += `<p class="info">2D Distance: ${dist2D ? dist2D.km.toExponential(6) + ' km' : 'ERROR'}</p>`;
        output += `<p class="info">3D Distance: ${dist3D ? dist3D.km.toExponential(6) + ' km' : 'ERROR'}</p>`;
        
        const matrix = calculator.calculateDistanceMatrix(testCoords, true, true);
        output += `<p class="${matrix ? 'success' : 'error'}">Distance Matrix: ${matrix ? 'PASS' : 'FAIL'}</p>`;
        output += '</div>';
        
        // Test 3: Dynamic Unit Scaling
        output += '<div class="test-section">';
        output += '<h2>Test 3: Dynamic Unit Scaling</h2>';
        
        const app = new GPSCalculatorApp();
        const testDistances = [
            0.000012345,  // Should be cm
            0.000001234,  // Should be mm
            0.001,        // Should be m
            1.0,          // Should be km
            0.000000001   // Should be mm
        ];
        
        testDistances.forEach((km, index) => {
            const formatted = app.formatDistanceWithDynamicUnits(km);
            output += `<p class="info">${km.toExponential(3)} km ‚Üí ${formatted.value} ${formatted.unit}</p>`;
        });
        output += '</div>';
        
        // Test 4: Your Sample Coordinates with Detailed Calculation
        output += '<div class="test-section">';
        output += '<h2>Test 4: Your Sample Coordinates - Detailed Calculation</h2>';
        
        const sampleCoords = [
            { name: "Control Point A", lat: 44.4734240583, lon: -70.8886269917, elevation: 500.143 },
            { name: "Control Point B", lat: 44.473424162, lon: -70.888626958, elevation: 500.1308 }
        ];
        
        // Create a mock detailed calculation display
        const coord1 = sampleCoords[0];
        const coord2 = sampleCoords[1];
        
        const deltaLat = coord2.lat - coord1.lat;
        const deltaLon = coord2.lon - coord1.lon;
        
        const latRad = coord1.lat * Math.PI / 180;
        const metersPerDegreeLat = 111132.92 - 559.82 * Math.cos(2 * latRad) + 1.175 * Math.cos(4 * latRad);
        const metersPerDegreeLon = 111412.84 * Math.cos(latRad) - 93.5 * Math.cos(3 * latRad);
        
        const deltaLatMeters = deltaLat * metersPerDegreeLat;
        const deltaLonMeters = deltaLon * metersPerDegreeLon;
        const horizontalDistance = Math.sqrt(deltaLatMeters * deltaLatMeters + deltaLonMeters * deltaLonMeters);
        const deltaHeight = coord2.elevation - coord1.elevation;
        
        const horizontalFormatted = app.formatDistanceWithDynamicUnits(horizontalDistance / 1000);
        const verticalFormatted = app.formatDistanceWithDynamicUnits(Math.abs(deltaHeight) / 1000);
        
        output += `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 10px 0;">
                <h4>Control Point A vs Control Point B</h4>
                <div style="background: white; padding: 15px; border-radius: 4px; margin: 10px 0;">
                    <h5>üîπ Step 1 ‚Äî Compute Horizontal Difference</h5>
                    <p><strong>ŒîLat</strong> = ${coord2.lat.toFixed(8)} ‚Äì ${coord1.lat.toFixed(8)} = ${deltaLat.toFixed(8)}¬∞</p>
                    <p><strong>ŒîLon</strong> = ${coord2.lon.toFixed(8)} ‚Äì (${coord1.lon.toFixed(8)}) = ${deltaLon.toFixed(8)}¬∞</p>
                    <br>
                    <p>At latitude ${coord1.lat.toFixed(2)}¬∞ N:</p>
                    <p>1¬∞ latitude ‚âà ${Math.round(metersPerDegreeLat)} m</p>
                    <p>1¬∞ longitude ‚âà ${Math.round(metersPerDegreeLon)} m</p>
                    <br>
                    <p>So:</p>
                    <p><strong>ŒîLat</strong> = ${deltaLat.toFixed(8)} √ó ${Math.round(metersPerDegreeLat)} ‚âà ${deltaLatMeters.toFixed(4)} m</p>
                    <p><strong>ŒîLon</strong> = ${deltaLon.toFixed(8)} √ó ${Math.round(metersPerDegreeLon)} ‚âà ${deltaLonMeters.toFixed(4)} m</p>
                    <br>
                    <p><strong>Horizontal offset</strong> = ‚àö(${deltaLatMeters.toFixed(4)}¬≤ + ${deltaLonMeters.toFixed(4)}¬≤) ‚âà ${horizontalDistance.toFixed(4)} m = <strong>${horizontalFormatted.value} ${horizontalFormatted.unit}</strong></p>
                </div>
                
                <div style="background: white; padding: 15px; border-radius: 4px; margin: 10px 0;">
                    <h5>üîπ Step 2 ‚Äî Compute Vertical Difference</h5>
                    <p><strong>ŒîHeight</strong> = ${coord2.elevation.toFixed(3)} ‚Äì ${coord1.elevation.toFixed(3)} = ${deltaHeight.toFixed(4)} m = <strong>${verticalFormatted.value} ${verticalFormatted.unit}</strong></p>
                </div>
                
                <div style="background: #e8f5e8; padding: 15px; border-radius: 4px; margin: 10px 0;">
                    <h5>‚úÖ Surveying Assessment</h5>
                    <p><strong>Survey Grade:</strong> First Order Survey Quality <span style="color: #667eea; cursor: pointer;">‚ùì</span><br>
                    <strong>Total 3D distance:</strong> ~${totalFormatted.value} ${totalFormatted.unit}<br>
                    <strong>Horizontal difference:</strong> ~${horizontalFormatted.value} ${horizontalFormatted.unit}<br>
                    <strong>Vertical difference:</strong> ~${verticalFormatted.value} ${verticalFormatted.unit}<br>
                    <em>Suitable for high-precision engineering and geodetic control</em></p>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0;">
                    <h6>üìê Surveying Standards Reference:</h6>
                    <ul>
                        <li><strong>First Order:</strong> ¬±1mm to ¬±3mm (Geodetic control, high-precision engineering)</li>
                        <li><strong>Second Order Class I:</strong> ¬±3mm to ¬±10mm (Precise engineering surveys)</li>
                        <li><strong>Second Order Class II:</strong> ¬±10mm to ¬±30mm (General construction surveys)</li>
                        <li><strong>Third Order:</strong> ¬±30mm to ¬±1m (Mapping and lower-precision surveys)</li>
                        <li><strong>Fourth Order:</strong> ¬±1m+ (Rough mapping only)</li>
                    </ul>
                </div>
            </div>
        `;
        output += '</div>';
        
        // Test 5: New Features - Reference Point Mode, Condensed Output, and Help System
        output += '<div class="test-section">';
        output += '<h2>Test 5: New Features - Reference Point Mode, Condensed Output & Help System</h2>';
        
        output += '<h3>Reference Point Mode:</h3>';
        output += '<p>‚Ä¢ Select a reference point from dropdown</p>';
        output += '<p>‚Ä¢ All other points compared only to reference point</p>';
        output += '<p>‚Ä¢ Useful for surveying from a known control point</p>';
        
        output += '<h3>Condensed Output (Default):</h3>';
        output += '<p>‚Ä¢ Single table with all calculations</p>';
        output += '<p>‚Ä¢ No detailed step-by-step breakdown</p>';
        output += '<p>‚Ä¢ No survey grade assessments</p>';
        output += '<p>‚Ä¢ Clean, compact format for quick reference</p>';
        
        output += '<h3>Unit System Selection:</h3>';
        output += '<p>‚Ä¢ <strong>Meters:</strong> Metric system (mm, cm, m, km)</p>';
        output += '<p>‚Ä¢ <strong>Feet:</strong> Imperial system (in, ft, mi)</p>';
        output += '<p>‚Ä¢ <strong>US Survey Feet:</strong> US survey system (in, ft, mi)</p>';
        output += '<p>‚Ä¢ Dynamic scaling based on selected unit system</p>';
        output += '<p>‚Ä¢ All calculations performed in meters internally</p>';
        
        output += '<h3>Help System:</h3>';
        output += '<p>‚Ä¢ ‚ùì icons throughout the interface</p>';
        output += '<p>‚Ä¢ Click any ‚ùì for detailed help on that section</p>';
        output += '<p>‚Ä¢ Comprehensive explanations for all features</p>';
        output += '<p>‚Ä¢ Professional help popups with examples</p>';
        
        // Mock condensed table
        output += '<h3>Example Condensed Output:</h3>';
        output += `
            <table style="width: 100%; border-collapse: collapse; margin: 10px 0; font-family: monospace; font-size: 14px;">
                <tr style="background: #667eea; color: white;">
                    <th style="padding: 8px; border: 1px solid #404040;">From</th>
                    <th style="padding: 8px; border: 1px solid #404040;">To</th>
                    <th style="padding: 8px; border: 1px solid #404040;">Horizontal Distance</th>
                    <th style="padding: 8px; border: 1px solid #404040;">Vertical Distance</th>
                    <th style="padding: 8px; border: 1px solid #404040;">3D Distance</th>
                </tr>
                <tr style="background: #2c2c2c; color: #e1e8ed;">
                    <td style="padding: 8px; border: 1px solid #404040;">Control Point A</td>
                    <td style="padding: 8px; border: 1px solid #404040;">Control Point B</td>
                    <td style="padding: 8px; border: 1px solid #404040;">1.18 cm</td>
                    <td style="padding: 8px; border: 1px solid #404040;">1.22 cm</td>
                    <td style="padding: 8px; border: 1px solid #404040;">1.70 cm</td>
                </tr>
            </table>
        `;
        output += '</div>';
        
        // Test 6: Unit Scaling Ranges
        output += '<div class="test-section">';
        output += '<h2>Test 6: Unit Scaling Ranges</h2>';
        
        const unitTests = [
            { km: 0.0000001, expected: 'mm', desc: '0.1 mm' },
            { km: 0.000001, expected: 'mm', desc: '1 mm' },
            { km: 0.00001, expected: 'cm', desc: '1 cm' },
            { km: 0.0001, expected: 'cm', desc: '10 cm' },
            { km: 0.001, expected: 'm', desc: '1 m' },
            { km: 0.01, expected: 'm', desc: '10 m' },
            { km: 1, expected: 'km', desc: '1 km' }
        ];
        
        unitTests.forEach(test => {
            const result = app.formatDistanceWithDynamicUnits(test.km);
            const correct = result.unit === test.expected;
            const status = correct ? 'success' : 'error';
            output += `<p class="${status}">${test.desc}: ${result.value} ${result.unit} ${correct ? '‚úÖ' : '‚ùå'}</p>`;
        });
        output += '</div>';
        
        document.getElementById('output').innerHTML = output;
    </script>
</body>
</html>
